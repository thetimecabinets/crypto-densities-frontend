<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üêã Whale Wall Tracker ‚Äì CryptoDensities.pro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Track real-time crypto whale buy and sell walls by coin. Visualize price levels with high liquidity resistance.">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f3e5f5; /* Light Purple */
      margin: 0;
      padding: 0;
    }

    nav {
      background-color: #2c3e50;
      padding: 15px;
      color: white;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    nav a {
      color: white;
      text-decoration: none;
      font-weight: bold;
    }

    .main-layout {
      display: flex;
      max-width: 1400px;
      margin: 40px auto;
      padding: 0 20px;
      gap: 30px;
    }

    .content {
      flex: 3;
    }

    .sidebar {
      flex: 1;
      background-color: #fff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      height: fit-content;
    }

    h1, h2 {
      color: #2c3e50;
    }

    .filters, .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }

    .filter-group {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    select, button {
      padding: 6px 10px;
      font-size: 14px;
    }

    .tab-button {
      background-color: #e0e0e0;
      border: none;
      padding: 8px 14px;
      cursor: pointer;
      font-weight: bold;
      border-radius: 5px;
    }

    .tab-button.active {
      background-color: #6a1b9a;
      color: white;
    }

    .coin-table {
      display: none;
    }

    .coin-table.active {
      display: block;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background-color: white;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      margin-bottom: 40px;
    }

    th, td {
      padding: 12px;
      border-bottom: 1px solid #ddd;
      text-align: left;
    }

    .buy { color: green; font-weight: bold; }
    .sell { color: red; font-weight: bold; }

    .pulse {
      animation: pulseGlow 1.5s ease-in-out infinite;
      background-color: #fff8e1 !important;
    }

    @keyframes pulseGlow {
      0% { box-shadow: 0 0 0px rgba(255,165,0,0); }
      50% { box-shadow: 0 0 10px rgba(255,165,0,0.8); }
      100% { box-shadow: 0 0 0px rgba(255,165,0,0); }
    }

    @media (max-width: 900px) {
      .main-layout {
        flex-direction: column;
      }
    }

    @media (max-width: 768px) {
      nav {
        flex-direction: column;
        align-items: center;
      }
      .filters {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>

  <nav>
    <a href="/">üêã Whale Walls</a>
    <a href="/market-sentiment/">üìä Market Sentiment</a>
    <a href="/position-calculator/">üßÆ Position Calculator</a>
    <a href="/how-to-use-whale-wall/">üìò How It Works</a>
  </nav>

  <div class="main-layout">
    <div class="content">
      <h1>üêã Whale Wall Tracker by Coin</h1>
      <p>Experience real-time monitoring of massive buy and sell walls across major crypto pairs. Filter, explore, and react to where the smart money is placing resistance and support ‚Äî instantly and by coin.</p>

      <div class="filters">
        <div class="filter-group">
          <label for="exchangeFilter">Exchange:</label>
          <select id="exchangeFilter">
            <option value="">All</option>
            <option value="Binance">Binance</option>
            <option value="Bybit">Bybit</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="typeFilter">Type:</label>
          <select id="typeFilter">
            <option value="">All</option>
            <option value="buy">Buy</option>
            <option value="sell">Sell</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="valueFilter">Value:</label>
          <select id="valueFilter">
            <option value="">All</option>
            <option value="100000">> $100K</option>
            <option value="250000">> $250K</option>
            <option value="500000">> $500K</option>
            <option value="1000000">> $1M</option>
          </select>
        </div>
        <div class="filter-group">
          <label for="ageFilter">Age:</label>
          <select id="ageFilter">
            <option value="">All</option>
            <option value="3600">&lt; 1h</option>
            <option value="21600">&lt; 6h</option>
            <option value="86400">&lt; 24h</option>
            <option value=">86400">&gt; 24h</option>
          </select>
        </div>
        <button onclick="resetFilters()">Reset</button>
      </div>

      <div class="tabs" id="coinTabs"></div>
      <div id="coinTablesContainer"></div>
    </div>

    <div class="sidebar">
      <h2>üìå Featured Content</h2>
      <p>üß† Learn how to interpret whale walls and price reaction zones.</p>
      <p>üí° Tip: Combine order wall data with momentum shifts to detect fakeouts.</p>
      <p>üî• Popular tools: <a href="/position-calculator/">Position Calculator</a></p>
      <p>üìò Don‚Äôt miss: <a href="/how-to-use-whale-wall/">How This Works</a></p>
    </div>
  </div>

  <script>
    let rawData = [];
    let activeCoin = "";

    function formatNumberShort(n) {
      if (!n || isNaN(n)) return "N/A";
      if (n >= 1e9) return (n / 1e9).toFixed(1) + 'B';
      if (n >= 1e6) return (n / 1e6).toFixed(1) + 'M';
      if (n >= 1e3) return (n / 1e3).toFixed(1) + 'K';
      return n.toString();
    }

    async function fetchData() {
      try {
        const res = await fetch("https://api.cryptodensities.pro/api/walls");
        rawData = await res.json();
        renderTabs();
        renderTables();
      } catch (err) {
        console.error("Failed to fetch data:", err);
      }
    }

    function renderTabs() {
      const tabs = document.getElementById("coinTabs");
      let coins = [...new Set(rawData.map(w => w.coin))];

      coins.sort((a, b) => {
        if (a === 'BTC') return -1;
        if (b === 'BTC') return 1;
        if (a === 'ETH') return -1;
        if (b === 'ETH') return 1;
        return a.localeCompare(b);
      });

      tabs.innerHTML = coins.map((coin, i) => `
        <button class="tab-button ${i === 0 ? 'active' : ''}" onclick="setActiveCoin('${coin}')">${coin}</button>
      `).join("");
      activeCoin = coins[0];
    }

    function setActiveCoin(coin) {
      activeCoin = coin;
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-button').forEach(btn => {
        if (btn.innerText === coin) btn.classList.add('active');
      });
      renderTables();
    }

    function renderTables() {
      const container = document.getElementById("coinTablesContainer");
      container.innerHTML = "";

      const exchange = document.getElementById("exchangeFilter").value;
      const type = document.getElementById("typeFilter").value;
      const value = parseFloat(document.getElementById("valueFilter").value) || 0;
      const ageFilter = document.getElementById("ageFilter").value;

      const filtered = rawData.filter(w => {
        return w.coin === activeCoin &&
          (!exchange || w.exchange === exchange) &&
          (!type || w.type === type) &&
          (!value || w.value >= value) &&
          (
            !ageFilter ||
            (ageFilter === ">86400" && w.age_seconds > 86400) ||
            (ageFilter !== ">86400" && w.age_seconds <= parseFloat(ageFilter))
          );
      });

      const rows = filtered.map(w => {
        let icon = "";
        if (w.age_seconds <= 60) icon = "üÜï";
        else if (w.value > 1000000) icon = "üî•";
        else if (w.value > 500000) icon = "üêã";

        const pulseClass = w.age_seconds <= 60 ? "pulse" : "";

        return `
          <tr class="${pulseClass}">
            <td class="${w.type}">${icon} ${w.type.charAt(0).toUpperCase() + w.type.slice(1)}</td>
            <td>${w.exchange}</td>
            <td>${w.price.toLocaleString()}</td>
            <td>${w.quantity}</td>
            <td>$${formatNumberShort(w.value)}</td>
            <td>${w.distance}</td>
            <td>${w.age}</td>
            <td>${w.volatility ?? 'N/A'}</td>
            <td>$${formatNumberShort(w.volume)}</td>
          </tr>
        `;
      }).join("");

      container.innerHTML = `
        <table class="coin-table active">
          <thead>
            <tr>
              <th>Type</th><th>Exchange</th><th>Price ($)</th><th>Quantity</th>
              <th>Value ($)</th><th>Distance (%)</th><th>Age</th><th>Volatility</th><th>Volume</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
      `;
    }

    function resetFilters() {
      document.querySelectorAll(".filters select").forEach(select => select.value = "");
      renderTables();
    }

    document.querySelectorAll(".filters select").forEach(select => {
      select.addEventListener("change", renderTables);
    });

    fetchData();
  </script>
</body>
</html>
